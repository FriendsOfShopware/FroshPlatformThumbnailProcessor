{% block thumbnail_utility %}{% apply spaceless %}

    {% if attributes is not defined %}
        {% set attributes = {} %}
    {% endif %}

    {% if attributes.class %}
        {% set attributes = attributes|merge({'class': 'lazyload ' ~ attributes.class}) %}
    {% else %}
        {% set attributes = attributes|merge({'class': 'lazyload'}) %}
    {% endif %}

    {% if attributes.alt is not defined and media.translated.alt is defined %}
        {% set attributes = attributes|merge({'alt': media.translated.alt}) %}
    {% endif %}

    {% if attributes.title is not defined and media.translated.title is defined %}
        {% set attributes = attributes|merge({'title': media.translated.title}) %}
    {% endif %}

    {% set metaProportion = media.metaData %}
    {% set widths = [metaProportion.width] %}
    {% if media.thumbnails|length > 0 %}
        {% set thumbnails = media.thumbnails|filter((v) => v.width <= metaProportion.width)|sort|reverse %}

        {% if thumbnails %}
            {% for thumbnail in thumbnails %}
                {% if thumbnail.width not in widths %}
                    {% set widths = widths|merge([thumbnail.width]) %}
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endif %}

    {% set ratio = (metaProportion.width / max(metaProportion.height, 1))|round(3, 'floor') %}

    {% if fullWidth %}
        {% if ratio >= 1  %}
            {% set inlineStyle = "width: 100vw; height: " ~ (100 / ratio)|round(3) ~ "vw" %}
        {% else %}
            {% set inlineStyle = "width: " ~ (100 * ratio)|round(3)~ "vw; height: 100vw" %}
        {% endif %}
    {% endif %}

    {% set splittedPath = media.url|split('/media/') %}
    {% set mediaUrl = splittedPath[0] %}
    {% set mediaPath = "media/" ~ splittedPath[1] | sw_encode_url  %}

    {% block thumbnail_utility_img %}
        <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
             data-src="{{ config('FroshPlatformThumbnailProcessor.config.ThumbnailPattern')|replace(
                 {'{mediaUrl}' : mediaUrl,'{mediaPath}' : mediaPath}
             ) }}"
             data-widths="[{{ widths|join(',') }}]"
             data-sizes="auto"
             data-aspectratio="{{ ratio }}"
             data-parent-fit="contain"
        {% for key, value in attributes %} {{ key }}="{{ value }}"{% endfor %}
        {% if inlineStyle is defined %}
            style="{{ inlineStyle }}"
        {% endif %}
        />

    {% endblock %}
{% endapply %}{% endblock %}
